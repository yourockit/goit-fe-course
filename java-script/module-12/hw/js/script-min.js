window.onload=function(){let e=[];const t={page:document.querySelector("body"),form:document.querySelector(".js-form"),input:document.querySelector("input"),btnSearch:document.querySelector(".form__btn"),btnDelete:document.querySelector(".js-del"),linksList:document.querySelector(".js-list"),linksItem:document.querySelector(".js-item")},n=document.querySelector(".links__list"),r=document.querySelector("#links").innerHTML.trim(),o=Handlebars.compile(r),c=e=>{return o(e)};t.linksList.addEventListener("click",function(t){t.preventDefault();const n=t.target;if("BUTTON"!==n.nodeName)return;const r=n.closest("li"),o=r.querySelector("a").getAttribute("href");e=e.filter(e=>e.url!==o),r.remove(),data=[e.map(e=>e.innerHTML)]}),t.form.addEventListener("submit",function(r){r.preventDefault();const o=t.input.value,u=/^(ftp|http|https):\/\/[^ "]+$/.test(o);if(""===o||!u)return void alert("Введите корректную ссылку");const i=e.some(e=>e.url===t.input.value);t.form.reset(),(e=>fetch(`http://api.linkpreview.net/?key=5bc46fbf6c978842625dc46b85b5a25f333e5ce7f3f42&q=${e}`,{method:"GET",contentType:"application/json"}).then(e=>{if(e.ok)return e.json();throw new Error(`Ошибочка вышла: ${e.statusText}`)}).catch(e=>{console.log(`Ошибочка вышла : ${e}`)}))(o).then(t=>{i?alert("Эта ссылка уже есть в списке.. \nВведите другую ссылку"):(e.unshift(t),(e=>{const t=e.reduce((e,t)=>e+c(t),"");n.innerHTML=t})(e))})})};